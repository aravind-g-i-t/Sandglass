<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Evara - eCommerce HTML Template</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="user/assets/imgs/theme/favicon.svg">
    <!-- Template CSS -->
    <link rel="stylesheet" href="user/assets/css/main.css?v=3.4">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    

    <style>
        
        .address-card {
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f8f9fa;
        }
        .address-card label {
            display: block;
            margin-bottom: 10px;
        }
        .btn-small {
            font-size: 0.9rem;
        }
        
        .btn-danger {
            color: white;
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .mt-2 {
            margin-top: 10px;
        }


        #addressColumn {
        display: none;
        transition: all 0.3s ease-in-out;
        }
        .btn-custom {
          background-color: #088178;
          color: white;
        }
         .order-card {
        margin-bottom: 1.5rem;
        }
        /*.order-header {
        background-color: #f8f9fa;
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
        }*/
        .product-image {
        max-width: 100px;
        margin-right: 1rem;
        }
        .product-details {
        flex: 1;
        } 
        
      </style>
</head>

<body>
    <header class="header-area header-style-5">
        <!-- <div class="header-top header-top-ptb-1 d-none d-lg-block">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info">
                            <ul>
                                <li><i class="fi-rs-smartphone"></i> <a href="#">(+01) - 2345 - 6789</a></li>
                                <li><i class="fi-rs-marker"></i><a  href="page-contact.html">Our location</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-6 col-lg-4">
                        <div class="text-center">
                            <div id="news-flash" class="d-inline-block">
                                <ul>
                                    <li>Get great devices up to 50% off <a href="/shop">View details</a></li>
                                    <li>Supper Value Deals - Save more with coupons</li>
                                    <li>Trendy 25silver jewelry, save up 35% off today <a href="/shop">Shop now</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-4">
                        <div class="header-info header-info-right">
                            <ul>
                                <li>
                                    <a class="language-dropdown-active" href="#"> <i class="fi-rs-world"></i> English <i class="fi-rs-angle-small-down"></i></a>
                                    <ul class="language-dropdown">
                                        <li><a href="#"><img src="user/assets/imgs/theme/flag-fr.png" alt="">Français</a></li>
                                        <li><a href="#"><img src="user/assets/imgs/theme/flag-dt.png" alt="">Deutsch</a></li>
                                        <li><a href="#"><img src="user/assets/imgs/theme/flag-ru.png" alt="">Pусский</a></li>
                                    </ul>
                                </li>
                                <li><i class="fi-rs-user"></i><a href="page-login-register.html">Log In / Sign Up</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="header-bottom sticky-bar sticky-white-bg">
            <div class="container">
                <div class="header-wrap header-space-between position-relative">
                    <div class="logo logo-width-1">
                        <a href="/"><img src="user/assets/imgs/theme/sandglass-high-resolution-logo-transparent.svg" alt="logo"></a>
                    </div>
                    <div class="main-menu main-menu-grow main-menu-padding-1 main-menu-lh-1 main-menu-mrg-1 hm3-menu-padding d-none d-lg-block hover-boder">
                        <nav>
                            <ul>
                                <li><a  href="/">Home </a>
                                    
                                </li>
                                <li><a href="/shop">Shop </a>
                                    
                                </li>
                                
                                
                                <li><a href="#">About </a>
                                    
                                </li>
                                <li>
                                    <a href="page-contact.html">Contact</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                    <div class="header-action-right">
                        
                        <div class="header-action-2">
                            <div class="header-action-icon-2">
                                <a href="/wishlist">
                                    <img class="svgInject" alt="Evara" src="user/assets/imgs/theme/icons/icon-heart.svg">
                                </a>
                            </div>
                            <div class="header-action-icon-2">
                                <a class="mini-cart-icon" href="/cart">
                                    <img alt="Evara" src="user/assets/imgs/theme/icons/icon-cart.svg">
                                    <!-- <span class="pro-count blue">2</span> -->
                                </a>
                                
                            </div>
                            <div class="header-action-icon d-block d-lg-none">
                                <div class="burger-icon">
                                    <span class="burger-icon-top"></span>
                                    <span class="burger-icon-mid"></span>
                                    <span class="burger-icon-bottom"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div class="mobile-header-active mobile-header-wrapper-style">
        <div class="mobile-header-wrapper-inner">
            <div class="mobile-header-top">
                <div class="mobile-header-logo">
                    <a href="/"><img src="user/assets/imgs/theme/sandglass-high-resolution-logo-transparent.svg" alt="logo"></a>
                </div>
                <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
                    <button class="close-style search-close">
                        <i class="icon-top"></i>
                        <i class="icon-bottom"></i>
                    </button>
                </div>
            </div>
            <div class="mobile-header-content-area">
                <div class="mobile-search search-style-3 mobile-header-border">
                    <form action="#">
                        <input type="text" placeholder="Search for items…">
                        <button type="submit"><i class="fi-rs-search"></i></button>
                    </form>
                </div>
                <div class="mobile-menu-wrap mobile-header-border">
                    <div class="main-categori-wrap mobile-header-border">
                        <a class="categori-button-active-2" href="#">
                            <span class="fi-rs-apps"></span> Browse Categories
                        </a>
                        <div class="categori-dropdown-wrap categori-dropdown-active-small">
                            <ul>
                                <li><a href="/shop"><i class="evara-font-dress"></i>Women's Clothing</a></li>
                                <li><a href="/shop"><i class="evara-font-tshirt"></i>Men's Clothing</a></li>
                                <li> <a href="/shop"><i class="evara-font-smartphone"></i> Cellphones</a></li>
                                <li><a href="/shop"><i class="evara-font-desktop"></i>Computer & Office</a></li>
                                <li><a href="/shop"><i class="evara-font-cpu"></i>Consumer Electronics</a></li>
                                <li><a href="/shop"><i class="evara-font-home"></i>Home & Garden</a></li>
                                <li><a href="/shop"><i class="evara-font-high-heels"></i>Shoes</a></li>
                                <li><a href="/shop"><i class="evara-font-teddy-bear"></i>Mother & Kids</a></li>
                                <li><a href="/shop"><i class="evara-font-kite"></i>Outdoor fun</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- mobile menu start -->
                    <nav>
                        <ul class="mobile-menu">
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="/">Home</a>
                                <ul class="dropdown">
                                    <li><a href="/">Home 1</a></li>
                                    <li><a href="index-2.html">Home 2</a></li>
                                    <li><a href="index-3.html">Home 3</a></li>
                                    <li><a href="index-4.html">Home 4</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="/shop">shop</a>
                                <ul class="dropdown">
                                    <li><a href="/shop">Shop Grid – Right Sidebar</a></li>
                                    <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                                    <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                                    <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                                    <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Product – Right Sidebar</a></li>
                                            <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                                            <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="shop-filter.html">Shop – Filter</a></li>
                                    <li><a href="/wishlist">Shop – Wishlist</a></li>
                                    <li><a href="/cart">Shop – Cart</a></li>
                                    <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                                    <li><a href="shop-compare.html">Shop – Compare</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Mega menu</a>
                                <ul class="dropdown">
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Women's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Dresses</a></li>
                                            <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                                            <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                                            <li><a href="shop-product-right.html">Women's Sets</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Men's Fashion</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Jackets</a></li>
                                            <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                                            <li><a href="shop-product-right.html">Genuine Leather</a></li>
                                        </ul>
                                    </li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Technology</a>
                                        <ul class="dropdown">
                                            <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                                            <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                                            <li><a href="shop-product-right.html">Tablets</a></li>
                                            <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                                            <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="blog-category-fullwidth.html">Blog</a>
                                <ul class="dropdown">
                                    <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                                    <li><a href="blog-category-list.html">Blog Category List</a></li>
                                    <li><a href="blog-category-big.html">Blog Category Big</a></li>
                                    <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                                    <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product Layout</a>
                                        <ul class="dropdown">
                                            <li><a href="blog-post-left.html">Left Sidebar</a></li>
                                            <li><a href="blog-post-right.html">Right Sidebar</a></li>
                                            <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Pages</a>
                                <ul class="dropdown">
                                    <li><a href="page-about.html">About Us</a></li>
                                    <li><a href="page-contact.html">Contact</a></li>
                                    <li><a href="page-account.html">My Account</a></li>
                                    <li><a href="page-login-register.html">login/register</a></li>
                                    <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                                    <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                                    <li><a href="page-terms.html">Terms of Service</a></li>
                                    <li><a href="page-404.html">404 Page</a></li>
                                </ul>
                            </li>
                            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Language</a>
                                <ul class="dropdown">
                                    <li><a href="#">English</a></li>
                                    <li><a href="#">French</a></li>
                                    <li><a href="#">German</a></li>
                                    <li><a href="#">Spanish</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                    <!-- mobile menu end -->
                </div>
                <div class="mobile-header-info-wrap mobile-header-border">
                    <div class="single-mobile-header-info mt-30">
                        <a  href="page-contact.html"> Our location </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="page-login-register.html">Log In / Sign Up </a>
                    </div>
                    <div class="single-mobile-header-info">
                        <a href="#">(+01) - 2345 - 6789 </a>
                    </div>
                </div>
                <div class="mobile-social-icon">
                    <h5 class="mb-15 text-grey-4">Follow Us</h5>
                    <a href="#"><img src="user/assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                    <a href="#"><img src="user/assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                    <a href="#"><img src="user/assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                    <a href="#"><img src="user/assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                    <a href="#"><img src="user/assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                </div>
            </div>
        </div>
    </div>
    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="/" rel="nofollow">Home</a>
                    <span></span> Profile
                    
                </div>
            </div>
        </div>
        <section class="pt-20 pb-20">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 ">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="dashboard-menu  mb-50">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false"><i class="fi-rs-settings-sliders mr-10"></i>Personal Information</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true"><i class="fi-rs-marker mr-10"></i>Manage Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false"><i class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false"><i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order</a>
                                        </li>
                                        
                                        <li class="nav-item">
                                            <a class="nav-link" id="wallet-tab" data-bs-toggle="tab" href="#wallet" role="tab" aria-controls="account-detail" aria-selected="true"><i class="fi-rs-user mr-10"></i>Wallet</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="javascript:void(0)" onclick="showLogoutConfirmation()">
                                              <i class="fi-rs-sign-out mr-10"></i>Logout
                                            </a>
                                          </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class=" tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                                        <!-- <div class="card"> -->
                                            <!-- <div class="card-header">
                                                <h5 class="mb-0">Hello Rosie! </h5>
                                            </div> -->
                                            <div class="container ">
                                                <!-- Personal Information Section -->
                                                <div class="card">
                                                    <div class="card-header">
                                                        Personal Information
                                                    </div>
                                                    <div class="card-body">
                                                        <p><strong>Name:</strong> <span id="currentName"><%= userData.username %></span> 
                                                            <a data-toggle="modal" data-target="#editNameModal" href="#"><i class="fi-rs-edit"></i></a>
                                                        </p>
                                                        <p><strong>Phone Number:</strong> <span id="currentPhone"><%= userData.phone ? userData.phone : 'nil' %></span>
                                                            <a data-toggle="modal" data-target="#editPhoneModal" href="#"><i class="fi-rs-edit"></i></a>
                                                        </p>
                                                        <p><strong>Email:</strong> <%= userData.email %></p>
                                                        <div class="d-flex justify-content-start">
                                                            <button class="btn btn-custom" data-toggle="modal" data-target="#resetPasswordModal">Reset Password</button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                              </div>
                                              
                                              <!-- Edit Name Modal -->
                                                <div class="modal fade" id="editNameModal" tabindex="-1" role="dialog" aria-labelledby="editNameModalLabel" aria-hidden="true" data-user-id="<%= userData._id %>">
                                                    <div class="modal-dialog modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="editNameModalLabel">Edit Name</h5>
                                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                    <span aria-hidden="true">&times;</span>
                                                                </button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <form id="editNameForm">
                                                                    <div class="form-group">
                                                                        <label for="editName">Name</label>
                                                                        <input type="text" class="form-control" id="editName" value="<%= userData.username %>">
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                                <button type="button" class="btn btn-custom" onclick="saveName()">Save changes</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                              
                                              
                                              
                                              <!-- Edit Phone Modal -->
                                              <div class="modal fade" id="editPhoneModal" tabindex="-1" role="dialog" aria-labelledby="editPhoneModalLabel" aria-hidden="true" data-user-id="<%= userData._id %>">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="editPhoneModalLabel">Edit Phone Number</h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="editPhoneForm">
                                                                <div class="form-group">
                                                                    <label for="editPhone">Phone Number</label>
                                                                    <input type="tel" class="form-control" id="editPhone" value="<%= userData.phone ? userData.phone : '' %>">
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                            <button type="button" class="btn btn-custom" onclick="savePhone()">Save changes</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                              
                                              <!-- Reset Password Modal -->
                                              <div class="modal fade" id="resetPasswordModal" tabindex="-1" role="dialog" aria-labelledby="resetPasswordModalLabel" aria-hidden="true" data-user-id="<%= userData._id %>">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="resetPasswordModalLabel">Reset Password</h5>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="resetPasswordForm">
                                                                <div class="form-group">
                                                                    <label for="oldPassword">Old Password</label>
                                                                    <input type="password" class="form-control" id="oldPassword">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="newPassword">New Password</label>
                                                                    <input type="password" class="form-control" id="newPassword">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="confirmNewPassword">Confirm New Password</label>
                                                                    <input type="password" class="form-control" id="confirmNewPassword">
                                                                </div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                            <button type="button" class="btn btn-custom" onclick="resetPassword()">Confirm</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                              
                                        <!-- </div> -->
                                    </div>
                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
    <div class="card-header ">
        <h5 class="mb-0">Orders</h5>
    </div>
    <div class="card-body p-4" style="height: 500px; overflow-y: auto;">
        <div class="table-responsive">
            <% if (orderData && Array.isArray(orderData)) { %>
                <table class="table table-bordered">
                    <thead class="btn-custom">
                        <tr>
                            <th>Order ID</th>
                            <th>Date</th>
                            <th>Products</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <% orderData.forEach(order => { %>
                            <tr>
                                <td><%= order.orderId %></td>
                                <td><%= order.orderDate ? (order.orderDate).toISOString().split("T")[0] : 'N/A' %></td>
                                <td>
                                    <div class="card-header bg-light" style="cursor: pointer;" data-bs-toggle="collapse" data-bs-target="#collapse-<%= order.orderId %>">
                                        <p class="mb-0">Products <i class="fi-rs-angle-small-down mr-10"></i></p>
                                    </div>
                                </td>
                                <td>₹<%= order.payableAmount %></td>
                                <td><a class="btn btn-custom btn-sm" href="/order_details?orderId=<%= order.orderId %>">View</a></td>
                                
                            </tr>
                            <tr class="order-details">
                                <td colspan="5">
                                    <div class="card">
                                        <div id="collapse-<%= order.orderId %>" class="collapse">
                                            <div class="card-body">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>Product</th>
                                                            <th>Price</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% order.products.forEach(product => { %>
                                                            <tr>
                                                                <td>
                                                                    <span style="float: left;"><%= product.productId.productName %></span>
                                                                    <span style="float: right;">X<%= product.quantity %></span>
                                                                </td>
                                                                <td>₹<%= product.productPrice %></td>
                                                                <td>
                                                                    <span class="badge badge-info" id="statusOfProduct"><%= product.status %></span>
                                                                </td>
                                                                <td>
                                                                    <% if (['Pending', 'Processing', 'Shipped'].includes(product.status)) { %>
                                                                        <button id="cancelButton" class="btn btn-danger btn-sm" onclick="cancelOrder('<%= order._id %>', '<%= product._id %>')">Cancel</button>
                                                                    <% } else if (product.status === 'Delivered') { %>
                                                                        <button id="returnButton" class="btn btn-warning btn-sm" onclick="returnOrder('<%= order._id %>', '<%= product._id %>')">Return</button>
                                                                    <% } %>
                                                                </td>
                                                            </tr>
                                                        <% }) %>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            <% } else { %>
                <p>No orders found.</p>
            <% } %>
        </div>
    </div>
</div>

                                    <div class=" tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Orders tracking</h5>
                                            </div>
                                            <div class="card-body contact-from-area">
                                                <p>To track your order please enter your OrderID in the box below and press "Track" button. This was given to you on your receipt and in the confirmation email you should have received.</p>
                                                <div class="row">
                                                    <div class="col-lg-8">
                                                        <form class="contact-form-style mt-30 mb-50" action="#" method="post">
                                                            <div class="input-style mb-20">
                                                                <label>Order ID</label>
                                                                <input name="order-id" placeholder="Found in your order confirmation email" type="text" class="square">
                                                            </div>
                                                            <div class="input-style mb-20">
                                                                <label>Billing email</label>
                                                                <input name="billing-email" placeholder="Email you used during checkout" type="email" class="square">
                                                            </div>
                                                            <button class="submit submit-auto-width" type="submit">Track</button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    <div class=" tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                                        <div class="card-header">
                                            <h5 class="mb-0">Addresses</h5>
                                        </div>
                                        <br>
                                        <button id="addAddressBtn" class="btn btn-custom mb-20" data-toggle="modal" data-target="#addAddressModal">Add new address</button>

                                        <!-- Add Address Modal -->
                                        <div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
                                            <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                                </div>
                                                <div class="modal-body">
                                                <form action="/add_address" method="post" onsubmit="return validateFormAdd()">
                                                    <div class="form-group">
                                                    <input type="text" name="fullname" id="fullname" class="form-control" placeholder="Full name *" onblur="validateFullName()">
                                                    <p id="errorFullname" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="billing_address1" id="billing_address1" class="form-control" placeholder="Address line 1*" onblur="validateAddress()">
                                                    <p id="errorAddress" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="billing_address2" class="form-control" placeholder="Address line 2*">
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="city" id="city" class="form-control" placeholder="City / Town *" onblur="validateCity()">
                                                    <p id="errorCity" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="state" id="state" class="form-control" placeholder="State *" onblur="validateState()">
                                                    <p id="errorState" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="pincode" id="pincode" class="form-control" placeholder="Pincode / ZIP *" onkeypress="return isNumberKey(event)" onblur="validatePincode()">
                                                    <p id="errorPincode" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="phone" id="phone" class="form-control" placeholder="Phone *" onkeypress="return isNumberKey(event)" onblur="validatePhoneNo()">
                                                    <p id="errorPhone" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <input type="text" name="email" id="email" class="form-control" placeholder="Email address *" onblur="validateEmail()">
                                                    <p id="errorEmail" class="text-danger"></p>
                                                    </div>
                                                    <div class="form-group">
                                                    <button type="submit" class="btn btn-dark" name="add-address">Add address</button>
                                                    </div>
                                                </form>
                                                </div>
                                                <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                </div>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <% if (addressData && addressData.address && addressData.address.length > 0) { %>
                                                <h4>Saved Addresses</h4>
                                                <br>
                                                <div id="saved-addresses" class="row">
                                                    <% addressData.address.forEach((data, index) => { %>
                                                        <div class="col-md-6 mb-4">
                                                            <div class="card address-card p-3">
                                                                <label for="address<%= index %>">
                                                                    <strong><%= data.fullName %></strong><br>
                                                                    <%= data.addressLine1 %><br>
                                                                    <%= data.addressLine2 %><br>
                                                                    <%= data.city %>, <%= data.state %>, <%= data.pincode %><br>
                                                                    Phone: <%= data.phoneNo %><br>
                                                                    Email: <%= data.email %>
                                                                </label>
                                                                <div class="mt-2">
                                                                    <a style="cursor: pointer;" onclick="editAddress('<%= data.fullName %>', '<%= data.addressLine1 %>', '<%= data.addressLine2 %>', '<%= data.city %>', '<%= data.state %>', '<%= data.pincode %>', '<%= data.phone %>', '<%= data.email %>', '<%= data._id %>')" class="btn btn-sm btn-custom">Edit</a>
                                                                    
                                                                    <a style="cursor: pointer;" onclick="deleteAddress('<%= data._id %>')" class="btn btn-sm btn-danger">Delete</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <% }) %>
                                                </div>
                                            <% } else { %>
                                                <h6>No addresses</h6>
                                            <% } %>
                                        </div>
                                        
                                        
                                    </div>
                                    <div class=" tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                                        <div class="card">
                                            <% if(walletData){ %>
                                                <div class="card-body">
                                                    <div class="wallet-balance mb-4">
                                                        <h5>Wallet Balance</h5>
                                                        <p id="wallet-amount" class="display-4 text-brand">₹<%= Math.floor(walletData.walletBalance) %></p>
                                                    </div>
                                                    <div class="wallet-details">
                                                        <h5 class="mb-10">Details</h5>
                                                        <div class="table-responsive">
                                                          <table class="table table-striped">
                                                            <thead>
                                                              <tr>
                                                                <th scope="col">Date</th>
                                                                <th scope="col">Type of Payment</th>
                                                                <th scope="col">Amount</th>
                                                              </tr>
                                                            </thead>
                                                            <tbody id="wallet-details-list">
                                                              
                                                            </tbody>
                                                          </table>
                                                        </div>
                                                        <div id="pagination-container" class="mt-3">
                                                          
                                                        </div>
                                                      </div>
                                                </div>
                                            <% } else { %>
                                                <div class="card-body">
                                                    <div class="wallet-balance mb-4">
                                                        <h5>Wallet Balance</h5>
                                                        <p id="wallet-amount" class="display-4 text-brand">₹0</p>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <!-- <footer class="main">
        <section class="newsletter p-30 text-white wow fadeIn animated">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 mb-md-3 mb-lg-0">
                        <div class="row align-items-center">
                            <div class="col flex-horizontal-center">
                                <img class="icon-email" src="user/assets/imgs/theme/icons/icon-email.svg" alt="">
                                <h4 class="font-size-20 mb-0 ml-3">Sign up to Newsletter</h4>
                            </div>
                            <div class="col my-4 my-md-0 des">
                                <h5 class="font-size-15 ml-4 mb-0">...and receive <strong>$25 coupon for first shopping.</strong></h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        
                        <form class="form-subcriber d-flex wow fadeIn animated">
                            <input type="email" class="form-control bg-white font-small" placeholder="Enter your email">
                            <button class="btn bg-dark text-white" type="submit">Subscribe</button>
                        </form>
                        
                    </div>
                </div>
            </div>
        </section>
        <section class="section-padding footer-mid">
            <div class="container pt-15 pb-20">
                <div class="row">
                    <div class="col-lg-4 col-md-6">
                        <div class="widget-about font-md mb-md-5 mb-lg-0">
                            <div class="logo logo-width-1 wow fadeIn animated">
                                <a href="/"><img src="user/assets/imgs/theme/logo.svg" alt="logo"></a>
                            </div>
                            <h5 class="mt-20 mb-10 fw-600 text-grey-4 wow fadeIn animated">Contact</h5>
                            <p class="wow fadeIn animated">
                                <strong>Address: </strong>562 Wellington Road, Street 32, San Francisco
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Phone: </strong>+01 2222 365 /(+91) 01 2345 6789
                            </p>
                            <p class="wow fadeIn animated">
                                <strong>Hours: </strong>10:00 - 18:00, Mon - Sat
                            </p>
                            <h5 class="mb-10 mt-30 fw-600 text-grey-4 wow fadeIn animated">Follow Us</h5>
                            <div class="mobile-social-icon wow fadeIn animated mb-sm-5 mb-md-0">
                                <a href="#"><img src="user/assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
                                <a href="#"><img src="user/assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
                                <a href="#"><img src="user/assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
                                <a href="#"><img src="user/assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
                                <a href="#"><img src="user/assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <h5 class="widget-title wow fadeIn animated">About</h5>
                        <ul class="footer-list wow fadeIn animated mb-sm-5 mb-md-0">
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Delivery Information</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Terms &amp; Conditions</a></li>
                            <li><a href="#">Contact Us</a></li>
                            <li><a href="#">Support Center</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-2  col-md-3">
                        <h5 class="widget-title wow fadeIn animated">My Account</h5>
                        <ul class="footer-list wow fadeIn animated">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">View Cart</a></li>
                            <li><a href="#">My Wishlist</a></li>
                            <li><a href="#">Track My Order</a></li>
                            <li><a href="#">Help</a></li>
                            <li><a href="#">Order</a></li>
                        </ul>
                    </div>
                    <div class="col-lg-4">
                        <h5 class="widget-title wow fadeIn animated">Install App</h5>
                        <div class="row">
                            <div class="col-md-8 col-lg-12">
                                <p class="wow fadeIn animated">From App Store or Google Play</p>
                                <div class="download-app wow fadeIn animated">
                                    <a href="#" class="hover-up mb-sm-4 mb-lg-0"><img class="active" src="user/assets/imgs/theme/app-store.jpg" alt=""></a>
                                    <a href="#" class="hover-up"><img src="user/assets/imgs/theme/google-play.jpg" alt=""></a>
                                </div>
                            </div>
                            <div class="col-md-4 col-lg-12 mt-md-3 mt-lg-0">
                                <p class="mb-20 wow fadeIn animated">Secured Payment Gateways</p>
                                <img class="wow fadeIn animated" src="user/assets/imgs/theme/payment-method.png" alt="">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div class="container pb-20 wow fadeIn animated">
            <div class="row">
                <div class="col-12 mb-20">
                    <div class="footer-bottom"></div>
                </div>
                <div class="col-lg-6">
                    <p class="float-md-left font-sm text-muted mb-0">&copy; 2022, <strong class="text-brand">Evara</strong> - HTML Ecommerce Template </p>
                </div>
                <div class="col-lg-6">
                    <p class="text-lg-end text-start font-sm text-muted mb-0">
                        Designed by <a href="http://alithemes.com" target="_blank">Alithemes.com</a>. All rights reserved
                    </p>
                </div>
            </div>
        </div>
    </footer> -->
    <!-- Preloader Start -->
    <!-- <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="text-center">
                    <h5 class="mb-5">Now Loading</h5>
                    <div class="loader">
                        <div class="bar bar1"></div>
                        <div class="bar bar2"></div>
                        <div class="bar bar3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->
    <!-- Vendor JS-->
    <script>
        function activateTabFromURL() {
            // Get the 'tab' parameter from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');

            if (tabParam) {
                // Find the tab link with the corresponding href
                const tabLink = document.querySelector(`.nav-link[href="#${tabParam}"]`);
                if (tabLink) {
                    // Activate the tab
                    const tab = new bootstrap.Tab(tabLink);
                    tab.show();

                    // Scroll to the tab content
                    const tabContent = document.querySelector(`#${tabParam}`);
                    if (tabContent) {
                        tabContent.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }
        }

        // Call the function when the page loads
        document.addEventListener('DOMContentLoaded', activateTabFromURL);
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function saveName() {
            // Get the user ID from the modal's data attribute
            const modal = document.getElementById('editNameModal');
            const userId = modal.getAttribute('data-user-id');
            const url = `http://sandglass.store/edit_name/${userId}`;
            
            const data = {
                name: document.getElementById('editName').value
            };

            console.log('Sending PUT request to:', url);
            console.log('Data:', data);
            
            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response JSON:', data);
                if (data && data.user) {
                    console.log('Success:', data);
                    alert('Name updated successfully');
                    // Redirect to /profile
                    window.location.href = '/profile';
                } else {
                    console.error('Failed to update name');
                    alert('Failed to update name');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update name');
            });
        }

        function savePhone() {
            // Get the user ID from the modal's data attribute
            const modal = document.getElementById('editPhoneModal');
            const userId = modal.getAttribute('data-user-id');
            const url = `http://sandglass.store/edit_phone/${userId}`;
            
            const data = {
                phone: document.getElementById('editPhone').value
            };

            console.log('Sending PUT request to:', url);
            console.log('Data:', data);
            
            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response JSON:', data);
                if (data && data.user) {
                    console.log('Success:', data);
                    alert('Phone number updated successfully');
                    // Update the displayed phone number on the page
                    document.getElementById('currentPhone').innerText = data.user.phone;

                    // Redirect to /profile
                    window.location.href = '/profile';
                } else {
                    console.error('Failed to update phone number');
                    alert('Failed to update phone number');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to update phone number');
            });
        }

        function resetPassword() {
            const modal = document.getElementById('resetPasswordModal');
            const userId = modal.getAttribute('data-user-id');
            const url = `http://sandglass.store/reset_password/${userId}`;
            
            const data = {
                oldPassword: document.getElementById('oldPassword').value,
                newPassword: document.getElementById('newPassword').value,
                confirmNewPassword: document.getElementById('confirmNewPassword').value
            };

            fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password reset successfully');
                    window.location.href = '/profile';
                } else {
                    alert('Password reset failed: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to reset password');
            });
        }





        function validateFullName() {
            let fullname = document.getElementById('fullname').value
            let errorDiv = document.getElementById('errorFullname')
            if(fullname === '' || fullname === ' '){
                errorDiv.textContent = 'Enter name'
                return false
            } else {
                errorDiv.textContent = ''
                return true
            }
        }

        function validateAddress(){
            let address = document.getElementById('billing_address1').value;
            let errorDiv = document.getElementById('errorAddress')
            if(address === '' || address === ' '){
                errorDiv.textContent = 'Enter address'
                return false
            } else {
                errorDiv.textContent = ''
                return true
            }
        }

        function validateCity(){
            let city = document.getElementById('city').value
            let errorDiv = document.getElementById('errorCity')
            if(city === '' || city === ' '){
                errorDiv.textContent = 'Enter city / town'
                return false
            } else {
                errorDiv.textContent = ''
                return true
            }
        }

        function validateState(){
            const validStates = [
                "Andhra Pradesh",
                "Arunachal Pradesh",
                "Assam",
                "Bihar",
                "Chhattisgarh",
                "Goa",
                "Gujarat",
                "Haryana",
                "Himachal Pradesh",
                "Jharkhand",
                "Karnataka",
                "Kerala",
                "Madhya Pradesh",
                "Maharashtra",
                "Manipur",
                "Meghalaya",
                "Mizoram",
                "Nagaland",
                "Odisha",
                "Punjab",
                "Rajasthan",
                "Sikkim",
                "Tamil Nadu",
                "Telangana",
                "Tripura",
                "Uttar Pradesh",
                "Uttarakhand",
                "West Bengal",
                "andhra pradesh",
                "arunachal pradesh",
                "assam",
                "bihar",
                "chhattisgarh",
                "goa",
                "gujarat",
                "haryana",
                "himachal pradesh",
                "jharkhand",
                "karnataka",
                "kerala",
                "madhya pradesh",
                "maharashtra",
                "manipur",
                "meghalaya",
                "mizoram",
                "nagaland",
                "odisha",
                "punjab",
                "rajasthan",
                "sikkim",
                "tamil nadu",
                "telangana",
                "tripura",
                "uttar pradesh",
                "uttarakhand",
                "west bengal",
                "ANDHRA PRADESH",
                "ARUNACHAL PRADESH",
                "ASSAM",
                "BIHAR",
                "CHHATTISGARH",
                "GOA",
                "GUJARAT",
                "HARYANA",
                "HIMACHAL PRADESH",
                "JHARKHAND",
                "KARNATAKA",
                "KERALA",
                "MADHYA PRADESH",
                "MAHARASHTRA",
                "MANIPUR",
                "MEGHALAYA",
                "MIZORAM",
                "NAGALAND",
                "ODISHA",
                "PUNJAB",
                "RAJASTHAN",
                "SIKKIM",
                "TAMIL NADU",
                "TELANGANA",
                "TRIPURA",
                "UTTAR PRADESH",
                "UTTARAKHAND",
                "WEST BENGAL"
            ];
            let state = document.getElementById('state').value.trim()
            let errorDiv = document.getElementById('errorState')
            if(validStates.includes(state)){
                errorDiv.textContent = ''
                return true;
            } else {
                errorDiv.textContent = 'Enter a valid state'
                return false;
            }
        }

        function validatePincode(){
            let pincode = document.getElementById('pincode').value
            let errorDiv = document.getElementById('errorPincode')
            const pincodePattern = /^[1-9][0-9]{5}$/;
            if (pincodePattern.test(pincode)){
                errorDiv.textContent = '';
                return true
            } else {
                errorDiv.textContent = 'Enter a valid pincode'
                return false
            }
        }

        function validatePhoneNo(){
            let phoneNo = document.getElementById('phone').value
            let errorDiv = document.getElementById('errorPhone')
            const phonePattern = /^[0-9]{10}$/;
            if(phonePattern.test(phoneNo)){
                errorDiv.textContent = ''
                return true
            } else {
                errorDiv.textContent = 'Enter a valid phone number'
                return false
            }
        }

        function validateEmail(){
            let email = document.getElementById('email').value
            let errorDiv = document.getElementById('errorEmail')
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            if(emailPattern.test(email)){
                errorDiv.textContent = ''
                return true
            } else {
                errorDiv.textContent = 'Enter a valid email address'
                return false
            }
        }

        function validateFormAdd(){
            const fullname = validateFullName()
            const address = validateAddress()
            const city = validateCity()
            const state = validateState()
            const pincode = validatePincode()
            const phoneNo = validatePhoneNo()
            const email = validateEmail()

            return fullname && address && city && state && pincode && phoneNo && email
        }

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)){
                return false;
            }
            return true;
        }
        

        async function editAddress(fullName, addressLine1, addressLine2, city, state, pincode, phoneNo, email, addressId) {
            const existingAddress = {
                fullname: fullName,
                billing_address1: addressLine1,
                billing_address2: addressLine2,
                city: city,
                state: state,
                pincode: pincode,
                phone: phoneNo,
                email: email
            };
            console.log('Existing address:',existingAddress)

            Swal.fire({
                title: 'Edit Address',
                html: `
                    <div class="form-group">
                        <input type="text" id="swal-fullname" class="form-control" placeholder="Full name *" value="${existingAddress.fullname}">
                        <p id="errorSwalFullname" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-billing_address1" class="form-control" placeholder="Address *" value="${existingAddress.billing_address1}">
                        <p id="errorSwalAddress" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-billing_address2" class="form-control" placeholder="Address line2" value="${existingAddress.billing_address2}">
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-city" class="form-control" placeholder="City / Town *" value="${existingAddress.city}">
                        <p id="errorSwalCity" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-state" class="form-control" placeholder="State *" value="${existingAddress.state}">
                        <p id="errorSwalState" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-pincode" class="form-control" placeholder="Pincode / ZIP *" value="${existingAddress.pincode}" onkeypress="return isNumberKey(event)">
                        <p id="errorSwalPincode" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-phone" class="form-control" placeholder="Phone *" value="${existingAddress.phone}" onkeypress="return isNumberKey(event)">
                        <p id="errorSwalPhone" class="text-danger"></p>
                    </div>
                    <div class="form-group">
                        <input type="text" id="swal-email" class="form-control" placeholder="Email address *" value="${existingAddress.email}">
                        <p id="errorSwalEmail" class="text-danger"></p>
                    </div>
                `,
                focusConfirm: false,
                preConfirm: () => {
                    return {
                        fullname: document.getElementById('swal-fullname').value,
                        billing_address1: document.getElementById('swal-billing_address1').value,
                        billing_address2: document.getElementById('swal-billing_address2').value,
                        city: document.getElementById('swal-city').value,
                        state: document.getElementById('swal-state').value,
                        pincode: document.getElementById('swal-pincode').value,
                        phone: document.getElementById('swal-phone').value,
                        email: document.getElementById('swal-email').value,
                    };
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const updatedAddress = result.value;
                    console.log('Updated Address:', updatedAddress);
                    await fetch('/edit_address', {
                    method: "PUT",
                    headers: {
                        'Content-Type': "application/json",
                    },
                    body: JSON.stringify({address: updatedAddress, addressId: addressId})
                }).then(response => {
                    if(response.ok){
                        console.log('Successfull updated')
                        window.location.href = '/profile??tab=orders'
                    }
                })
                    
                    // Here you can update the form fields with the new values or send the data to the server
                }
            });
        }

        function deleteAddress(addressId) {
            console.log(`Address Id ${addressId}`)
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you really want to delete this address? This process cannot be undone.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await fetch('/delete_address', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({addressId: addressId}),
                    }).then(response => {
                        if(response.ok){
                            console.log(`Successfully deleted`)
                            // window.href('/profile#address')
                        }
                    })
                    window.location.href = '/profile'
                }
            })
        }

        function showLogoutConfirmation() {
            Swal.fire({
                title: 'Confirm Logout',
                text: "Are you sure you want to logout?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '/logout';
                }
            });
        }

        function cancelOrder(orderId, productId) {
            console.log(orderId, productId);
            
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you really want to cancel this order? This process cannot be undone.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, cancel it!'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    console.log('Cancellation confirmed');
                    document.getElementById('cancelButton').style.display = 'none';
                    document.getElementById('statusOfProduct').innerText = 'Cancelled';
                    
                    try {
                        console.log('Sending fetch request');
                        const response = await fetch('/cancel_order', {
                            method: 'PATCH',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ orderId, productId })
                        });

                        if (response.ok) {
                            console.log('Success');
                            window.location.href = '/profile';
                        } else {
                            console.error('Error:', await response.json());
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                    }
                }
            }).catch(error => {
                console.error('Swal error:', error);
            });
        }


        function returnOrder(orderId, productId) {
            console.log('orderId and productId -- ', orderId, productId)
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you really want to return this order?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes!'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Reason for Return',
                        input: 'textarea',
                        inputLabel: 'Please provide the reason for returning the order:',
                        inputPlaceholder: 'Type your reason here...',
                        inputAttributes: {
                            'aria-label': 'Type your reason here'
                        },
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Submit',
                        preConfirm: (reason) => {
                            if (!reason) {
                                Swal.showValidationMessage('You need to write something!');
                            }
                            return reason;
                        }
                    }).then((result) => {
                        if (result.isConfirmed) {
                            document.getElementById('returnButton').style.display = 'none'
                            document.getElementById('statusOfProduct').innerText = 'Return Pending'
                            const reason = result.value;
                            Swal.fire({
                                title: 'Thank you!',
                                text: 'Your return request has been submitted.',
                                icon: 'success'
                            });
                            // You can also send the reason to your server here
                            fetch('/return_order', {
                                method: 'PATCH',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({orderId: orderId, productId: productId, reason: reason})
                            })
                            console.log('Reason for return:', reason);
                        }
                    });
                }
            });
        }
    </script>
    <script>
        let currentPage = 1;

        function loadWalletTransactions(page = 1) {
        fetch(`/wallet-transactions?page=${page}`)
            .then(response => response.json())
            .then(data => {
            const transactionsList = document.getElementById('wallet-details-list');
            transactionsList.innerHTML = ''; // Clear existing transactions

            data.transactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${new Date(transaction.time).toISOString().split('T')[0]}</td>
                <td>${transaction.type}</td>
                <td class="${transaction.type === 'Credit' ? 'text-success' : 'text-danger'}">
                    ${transaction.type === 'Credit' ? '+' : '-'} ₹${transaction.amount}
                </td>
                `;
                transactionsList.appendChild(row);
            });

            updatePaginationControls(data.currentPage, data.totalPages);
            })
            .catch(error => console.error('Error:', error));
        }

        function updatePaginationControls(currentPage, totalPages) {
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = '';

            if (totalPages > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = 'Previous';
                prevButton.classList.add('btn', 'btn-secondary', 'mr-2');
                prevButton.disabled = currentPage === 1;
                prevButton.addEventListener('click', () => loadWalletTransactions(currentPage - 1));
                paginationContainer.appendChild(prevButton);

                // Define startPage and endPage so that three pages are shown if possible
                let startPage = Math.max(1, currentPage - 1);
                let endPage = Math.min(totalPages, currentPage + 1);

                // Adjust the range to always show 3 pages when possible
                if (currentPage === 1) {
                    endPage = Math.min(totalPages, currentPage + 2); // Show next two pages
                } else if (currentPage === totalPages) {
                    startPage = Math.max(1, totalPages - 2); // Show previous two pages
                }

                // Create page buttons
                for (let i = startPage; i <= endPage; i++) {
                    const pageButton = document.createElement('button');
                    pageButton.textContent = i;
                    pageButton.classList.add('btn', 'btn-primary', 'mx-1');
                    if (i === currentPage) {
                        pageButton.disabled = true;
                    }
                    pageButton.addEventListener('click', () => loadWalletTransactions(i));
                    paginationContainer.appendChild(pageButton);
                }

                const nextButton = document.createElement('button');
                nextButton.textContent = 'Next';
                nextButton.classList.add('btn', 'btn-secondary', 'ml-2');
                nextButton.disabled = currentPage === totalPages;
                nextButton.addEventListener('click', () => loadWalletTransactions(currentPage + 1));
                paginationContainer.appendChild(nextButton);
            }
        }



        // Initial load
        document.addEventListener('DOMContentLoaded', () => loadWalletTransactions());

    </script>
    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="user/assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="user/assets/js/vendor/jquery-3.6.0.min.js"></script>
    <script src="user/assets/js/vendor/jquery-migrate-3.3.0.min.js"></script>
    <script src="user/assets/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="user/assets/js/plugins/slick.js"></script>
    <script src="user/assets/js/plugins/jquery.syotimer.min.js"></script>
    <script src="user/assets/js/plugins/wow.js"></script>
    <script src="user/assets/js/plugins/jquery-ui.js"></script>
    <script src="user/assets/js/plugins/perfect-scrollbar.js"></script>
    <script src="user/assets/js/plugins/magnific-popup.js"></script>
    <script src="user/assets/js/plugins/select2.min.js"></script>
    <script src="user/assets/js/plugins/waypoints.js"></script>
    <script src="user/assets/js/plugins/counterup.js"></script>
    <script src="user/assets/js/plugins/jquery.countdown.min.js"></script>
    <script src="user/assets/js/plugins/images-loaded.js"></script>
    <script src="user/assets/js/plugins/isotope.js"></script>
    <script src="user/assets/js/plugins/scrollup.js"></script>
    <script src="user/assets/js/plugins/jquery.vticker-min.js"></script>
    <script src="user/assets/js/plugins/jquery.theia.sticky.js"></script>
    <!-- Template  JS -->
    <script src="./user/assets/js/main.js?v=3.4"></script>
</body>

</html>